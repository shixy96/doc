<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql | doc</title>
    <meta name="description" content="施翔宇的个人文档">
    <link rel="stylesheet" href="/assets/style.41726b26.css">
    <link rel="modulepreload" href="/assets/app.468f540d.js">
    <link rel="modulepreload" href="/assets/server_database_mysql_必知必会.md.23977e56.lean.js">
    
    <link rel="icon" href="/favicon.jpg">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-0dd73670><!--[--><!--]--><!--[--><span tabindex="-1" data-v-b45a8805></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-b45a8805> Skip to content </a><!--]--><!----><header class="VPNav" data-v-0dd73670 data-v-b71ddd30><div class="VPNavBar has-sidebar" data-v-b71ddd30 data-v-eccc28dd><div class="container" data-v-eccc28dd><div class="VPNavBarTitle has-sidebar" data-v-eccc28dd data-v-4208b882><a class="title" href="/" data-v-4208b882><!--[--><!--]--><!----><!--[-->shixy<!--]--><!--[--><!--]--></a></div><div class="content" data-v-eccc28dd><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-eccc28dd data-v-696ccc98><span id="main-nav-aria-label" class="visually-hidden" data-v-696ccc98>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/front-end/js/index.html" data-v-696ccc98 data-v-644fa046 data-v-67783dc9><!--[-->前端<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/server/database/mysql/index.html" data-v-696ccc98 data-v-644fa046 data-v-67783dc9><!--[-->后端<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html" data-v-696ccc98 data-v-644fa046 data-v-67783dc9><!--[-->设计模式<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-696ccc98 data-v-a6dd6545><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-a6dd6545><span class="text" data-v-a6dd6545><!----> 其他 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-a6dd6545><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-a6dd6545><div class="VPMenu" data-v-a6dd6545 data-v-857bd1d4><div class="items" data-v-857bd1d4><!--[--><!--[--><div class="VPMenuLink" data-v-857bd1d4 data-v-4989b3bb><a class="VPLink link" href="/util/command/git.html" data-v-4989b3bb data-v-67783dc9><!--[-->命令行工具<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-eccc28dd data-v-dd448478><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-dd448478 data-v-abbbf13a data-v-8b63d125><span class="check" data-v-8b63d125><span class="icon" data-v-8b63d125><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-abbbf13a><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-abbbf13a><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-eccc28dd data-v-58029811 data-v-a6dd6545><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-a6dd6545><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-a6dd6545><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-a6dd6545><div class="VPMenu" data-v-a6dd6545 data-v-857bd1d4><!----><!--[--><!--[--><!----><div class="group" data-v-58029811><div class="item appearance" data-v-58029811><p class="label" data-v-58029811>Appearance</p><div class="appearance-action" data-v-58029811><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-58029811 data-v-abbbf13a data-v-8b63d125><span class="check" data-v-8b63d125><span class="icon" data-v-8b63d125><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-abbbf13a><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-abbbf13a><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-eccc28dd data-v-3ea288f5><span class="container" data-v-3ea288f5><span class="top" data-v-3ea288f5></span><span class="middle" data-v-3ea288f5></span><span class="bottom" data-v-3ea288f5></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-0dd73670 data-v-6b8a8242><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-6b8a8242><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-6b8a8242><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-6b8a8242>Menu</span></button><a class="top-link" href="#" data-v-6b8a8242> Return to top </a></div><aside class="VPSidebar" data-v-0dd73670 data-v-8311cc44><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-8311cc44><span class="visually-hidden" id="sidebar-aria-label" data-v-8311cc44> Sidebar Navigation </span><!--[--><div class="group" data-v-8311cc44><section class="VPSidebarGroup" data-v-8311cc44 data-v-69237d58><div class="title" data-v-69237d58><h2 class="title-text" data-v-69237d58>java</h2><div class="action" data-v-69237d58><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-69237d58><!--[--><!--[--><a class="VPLink link link" href="/server/java/0-jvm%20params.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>0-jvm params</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/java/1-memory%20area.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>1-memory area</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/java/2-GarBage%20collect.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>2-GarBage collect</span><!--]--><!----></a><!----><!--]--><!--[--><span class="VPLink link" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>并发编程</span><!--]--><!----></span><!--[--><!--[--><a class="VPLink link link" href="/server/java/concurrent/%E5%9F%BA%E7%A1%80.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>基础</span><!--]--><!----></a><!----><!--]--><!--[--><span class="VPLink link" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>锁</span><!--]--><!----></span><!--[--><!--[--><a class="VPLink link link" href="/server/java/%E9%94%81.html" style="padding-left:32px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>lock</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/java/reentrantlock.html" style="padding-left:32px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>reentrantlock</span><!--]--><!----></a><!----><!--]--><!--]--><!--]--><!--[--><span class="VPLink link" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>线程</span><!--]--><!----></span><!--[--><!--[--><a class="VPLink link link" href="/server/java/threadlocal.html" style="padding-left:32px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>threadlocal</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/java/%E7%BA%BF%E7%A8%8B%E6%B1%A0.html" style="padding-left:32px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>线程池</span><!--]--><!----></a><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--[--><a class="VPLink link link" href="/server/java/compare.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>compare</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-8311cc44><section class="VPSidebarGroup" data-v-8311cc44 data-v-69237d58><div class="title" data-v-69237d58><h2 class="title-text" data-v-69237d58>数据库</h2><div class="action" data-v-69237d58><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-69237d58><!--[--><!--[--><span class="VPLink link" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>mysql</span><!--]--><!----></span><!--[--><!--[--><a class="VPLink link link active" href="/server/database/mysql/%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>必知必会</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/mysql/%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>基础类型</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/mysql/%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>数据目录</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/mysql/%E7%B4%A2%E5%BC%95%E9%A1%B5%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>索引页数据结构</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/mysql/%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>执行优化</span><!--]--><!----></a><!----><!--]--><!--]--><!--]--><!--[--><span class="VPLink link" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>elasticsearch</span><!--]--><!----></span><!--[--><!--[--><a class="VPLink link link" href="/server/database/elasticsearch/%E5%9F%BA%E7%A1%80.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>基础</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/elasticsearch/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>倒排索引</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/elasticsearch/%E6%96%87%E6%A1%A3CRUD.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>文档CRUD</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/elasticsearch/Mapping.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>Mapping</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/elasticsearch/search.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>Search</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/database/elasticsearch/search_api.html" style="padding-left:16px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text light" data-v-10e7fe7a>Search Api</span><!--]--><!----></a><!----><!--]--><!--]--><!--]--><!--]--></div></section></div><div class="group" data-v-8311cc44><section class="VPSidebarGroup" data-v-8311cc44 data-v-69237d58><div class="title" data-v-69237d58><h2 class="title-text" data-v-69237d58>docker</h2><div class="action" data-v-69237d58><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-69237d58><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-69237d58><!--[--><!--[--><a class="VPLink link link" href="/server/docker/image.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>image</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/docker/container.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>container</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/server/docker/compose.html" style="padding-left:0px;" data-v-10e7fe7a data-v-67783dc9><!--[--><span class="link-text" data-v-10e7fe7a>compose</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-0dd73670 data-v-e5c4cdba><div class="VPDoc has-sidebar has-aside" data-v-e5c4cdba data-v-bd22cb21><div class="container" data-v-bd22cb21><div class="aside" data-v-bd22cb21><div class="aside-curtain" data-v-bd22cb21></div><div class="aside-container" data-v-bd22cb21><div class="aside-content" data-v-bd22cb21><div class="VPDocAside" data-v-bd22cb21 data-v-76ddb78d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-76ddb78d data-v-71bbc13b><div class="content" data-v-71bbc13b><div class="outline-marker" data-v-71bbc13b></div><div class="outline-title" data-v-71bbc13b>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-71bbc13b><span class="visually-hidden" id="doc-outline-aria-label" data-v-71bbc13b> Table of Contents for current page </span><ul class="root" data-v-71bbc13b data-v-c04a736d><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-76ddb78d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-bd22cb21><div class="content-container" data-v-bd22cb21><!--[--><!--]--><main class="main" data-v-bd22cb21><div style="position:relative;" class="vp-doc _server_database_mysql_%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A" data-v-bd22cb21><div><h1 id="mysql" tabindex="-1">Mysql <a class="header-anchor" href="#mysql" aria-hidden="true">#</a></h1><h3 id="正则表达式" tabindex="-1">正则表达式 <a class="header-anchor" href="#正则表达式" aria-hidden="true">#</a></h3><p>正则表达式区分大小写 REGEXP BINARY:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> XX </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> FIELD REGEXP </span><span style="color:#F78C6C;">BINARY</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Sample|As|[SM]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>转义：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">\\. 匹配.</span></span>
<span class="line"><span style="color:#A6ACCD;">\\n 匹配换行</span></span>
<span class="line"><span style="color:#A6ACCD;">\\r 匹配回车</span></span>
<span class="line"><span style="color:#A6ACCD;">\\\ 匹配\</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><img src="/assets/mysql-字符类.701c0f50.png" style="zoom:60%;"><img src="/assets/mysql-定位元字符.54594979.png" style="zoom:50%;"><p>​ 可以在不使用数据库表的情况下用SELECT来测试正则表达式。REGEXP检查总是返回0（没有匹配）或1（匹配）。可以用带文字串的REGEXP来测试表达式，并试验它们。相应的语法如下：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> REGEXP </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[0-9]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="数据处理函数" tabindex="-1">数据处理函数 <a class="header-anchor" href="#数据处理函数" aria-hidden="true">#</a></h3><p>省略 FROM 子句测试表达式</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Trim</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)；</span></span>
<span class="line"></span></code></pre></div><h4 id="_1-文本处理函数" tabindex="-1">1. 文本处理函数 <a class="header-anchor" href="#_1-文本处理函数" aria-hidden="true">#</a></h4><p>拼接字段 Concat()，别名 AS</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Concat</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">address</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> title </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> user;</span></span>
<span class="line"></span></code></pre></div><p>去除空格 RTrim(), LTrim(), Trim()</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Trim</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> user;</span></span>
<span class="line"></span></code></pre></div><p>转换大写 Upper()</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Upper</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> user;</span></span>
<span class="line"></span></code></pre></div><img src="/assets/mysql-文本处理函数.d6588609.png" style="zoom:50%;"><h4 id="_2-日期和时间处理函数" tabindex="-1">2. 日期和时间处理函数 <a class="header-anchor" href="#_2-日期和时间处理函数" aria-hidden="true">#</a></h4><img src="/assets/mysql-日期函数.60b82fe4.png" style="zoom:50%;"><p>日期格式为 yyyy-mm-dd</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Year</span><span style="color:#A6ACCD;">(order_date) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2020</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Month</span><span style="color:#A6ACCD;">(order_date) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">9</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="_3-数值处理函数" tabindex="-1">3. 数值处理函数 <a class="header-anchor" href="#_3-数值处理函数" aria-hidden="true">#</a></h4><img src="/assets/mysql-数值处理函数.4aae704b.png" style="zoom:50%;"><h3 id="数据汇总函数" tabindex="-1">数据汇总函数 <a class="header-anchor" href="#数据汇总函数" aria-hidden="true">#</a></h3><img src="/assets/mysql-聚集函数.87072d38.png" style="zoom:50%;"><p><em>AVG、MAX、MIN、SUM函数忽略列值为$NULL的行</em></p><p>COUNT(*) 对表中行的数目进行计数，包含NULL值；COUNT(column) 对特定列中有值的行计数，忽略NULL值。</p><p>DISTINCT 必须使用列名</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">DISTINCT</span><span style="color:#A6ACCD;"> price) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> avg_price </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> product;</span></span>
<span class="line"></span></code></pre></div><h3 id="数据分组" tabindex="-1">数据分组 <a class="header-anchor" href="#数据分组" aria-hidden="true">#</a></h3><p><strong>GROUP</strong>: 分组允许把数据分为多个逻辑组，以便能<strong>对每个组</strong>进行聚集计算。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> vender_id, </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> num_prods </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> vender_id;</span></span>
<span class="line"></span></code></pre></div><ul><li>GROUP BY 子句可以包含任意数目的列</li><li>除聚集计算语句外，SELECT语句中的每个列都必须在GROUP BY子句中给出。</li><li>如果分组列中具有NULL值，则NULL将作为一个分组返回。如果列中有多行NULL值，它们将分为一组。</li><li>WITH ROLLUP 返回分组汇总之后的值</li></ul><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">coalesce</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">总金额</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">), </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">money</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">money</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">WITH</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ROLLUP</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>HAVING</strong> 支持所有 WHERE 操作符，规定包括哪些分组，排除哪些分组</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_id, </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> orders </span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orders </span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> prod_price </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> cust_id </span></span>
<span class="line"><span style="color:#F78C6C;">HAVING</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> orders</span></span>
<span class="line"></span></code></pre></div><p>​ WHERE 在数据分组前进行过滤，HAVING 在数据分组后进行过滤。</p><h3 id="子查询" tabindex="-1">子查询 <a class="header-anchor" href="#子查询" aria-hidden="true">#</a></h3><p>嵌套在其他查询中的查询，不要嵌套太多子查询</p><ol><li>子查询作为条件</li></ol><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_name </span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> cust_id </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_id </span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orders</span></span>
<span class="line"><span style="color:#A6ACCD;">                 	</span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> order_num </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> order_num</span></span>
<span class="line"><span style="color:#A6ACCD;">                                      </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orderitems</span></span>
<span class="line"><span style="color:#A6ACCD;">                                      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> prod_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">APPLE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">));</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>子查询作为计算字段</li></ol><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_name, </span></span>
<span class="line"><span style="color:#A6ACCD;">			 cust_state, </span></span>
<span class="line"><span style="color:#A6ACCD;">			 (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> orders.cust_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> customers.cust_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> orders</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> cust_name;</span></span>
<span class="line"></span></code></pre></div><h3 id="联结-join" tabindex="-1">联结 JOIN <a class="header-anchor" href="#联结-join" aria-hidden="true">#</a></h3><p>外键为某个表中的一列，包含另一个表的主键值，定义了两个表之间的关系。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> vend_name, prod_name, prod_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> venders, products</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> venders.vender_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> products.vender_id</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> vender_name, prod_name;</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> vend_name, prod_name, prod_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> venders </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> products</span></span>
<span class="line"><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> venders.vender_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> products.vender_id</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> vender_name, prod_name;</span></span>
<span class="line"></span></code></pre></div><p>减少不必要的联结，联结的表越多，性能下降越厉害。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_name</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> c, orders </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> o, orderitems </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> oi</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> c.cust_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.cust_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> oi.order_num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.order_num</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> prod_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">APPLE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>自联结</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> p1.prod_id, p1.prod_name</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> p1, products </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> p2</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> p1.vender_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> p2.vender_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> p2.prod_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">XXX</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>外部联结</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> vend_name, </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(products.prod_id)</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> venders </span><span style="color:#F78C6C;">LEFT OUTER JOIN</span><span style="color:#A6ACCD;"> products</span></span>
<span class="line"><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> venders.vender_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> products.vender_id</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> venders.vender_id</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> vender_name;</span></span>
<span class="line"></span></code></pre></div><h3 id="组合查询" tabindex="-1">组合查询 <a class="header-anchor" href="#组合查询" aria-hidden="true">#</a></h3><ul><li>在单个查询中从不同的表返回类似结构的数据</li><li>对单个表执行多个查询，按单个查询返回数据</li></ul><p>多数情况下，结合相同表的两个查询完成的工作与具有多个where子句条件的单条查询完成的工作相同。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> vender_id, prod_id, prod_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> prod_id </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span></span>
<span class="line"><span style="color:#F78C6C;">UNION</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> vender_id, prod_id, prod_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> vender_id </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">1001</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">1002</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> vender_id, prod_price</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> vender_id, prod_id, prod_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> prod_id </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">OR</span><span style="color:#A6ACCD;"> vender_id </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">1001</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">1002</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> vender_id, prod_price</span></span>
<span class="line"></span></code></pre></div><p>​ UNION 中每个查询必须包含相同的列、表达式或聚集函数（次序不需要相同）；类数据类型必须兼容但不必相同。</p><p>​ UNION 从查询结果中自动去除了重复的行，使用 <em>UNION ALL</em> 返回所有匹配行。</p><h3 id="全文搜索" tabindex="-1">全文搜索 <a class="header-anchor" href="#全文搜索" aria-hidden="true">#</a></h3><p>​ mysql 最常用的引擎中，MyISAM支持全文搜索，InnoDB不支持。</p><p>​ 为了进行全文本索引，必须索引被搜索的列，而且要随着数据的改变不断地重新索引。在对列表进行适当设计后，Mysql会自动进行所有的索引和重新索引。在索引之后，SELECT 可与 Match() 和 Against() 一起使用以实际执行搜索。</p><p>​ 创建表时启用全文本搜索，CREATE TABLE 语句接收 FULLTEXT 子句，它给出被索引的一个逗号分隔的列表。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> productnotes</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	note_id		</span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;">				</span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;"> 	AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#A6ACCD;">  prod_id 	</span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">) 	</span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  note_date	</span><span style="color:#F78C6C;">datetime</span><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  note_text	</span><span style="color:#F78C6C;">text</span><span style="color:#A6ACCD;">			</span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">PRIMARY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">KEY</span><span style="color:#A6ACCD;">(note_id),</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">FULLTEXT</span><span style="color:#A6ACCD;">(note_text)</span></span>
<span class="line"><span style="color:#A6ACCD;">)	ENGINE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">MyISAM;</span></span>
<span class="line"></span></code></pre></div><p>​ Match() 函数指定被搜索的列，Against() 函数指定要使用的搜索表达式；返回以文本匹配的良好程度排序的数据，等级由 MYSQL 根据行中词的数目、唯一词的数目、整个索引中词的总数以及包含该词的行的数目计算出来。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> note_text, </span></span>
<span class="line"><span style="color:#A6ACCD;">			 Match(note_text) Against(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rabbit</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">rank</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productnotes;</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> note_text</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productnotes</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> Match(note_text) Against(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rabbit</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><p>​ 除非使用BINARY，否则全文本搜索不区分大小写。Match() 的值必须与FULLTEXT 定义中的相同。</p><p>​ 效果与下面语句相同：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> note_text</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productnotes</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> note_text </span><span style="color:#F78C6C;">LIKE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%rabbit%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="查询拓展（version-4-1-1）" tabindex="-1">查询拓展（version&gt;=4.1.1） <a class="header-anchor" href="#查询拓展（version-4-1-1）" aria-hidden="true">#</a></h4><ul><li>首先，进行一个基本的全文本搜索，找出与搜索条件匹配的所有行</li><li>其次，MYSQL 检查这些匹配行并选择所有有用的词</li><li>最后，MYSQL 再次进行全文本搜索，使用所有有用的词</li></ul><p>表中的行越多，查询拓展返回的结果越好。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 只返回包含 anvils 的行</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> note_text</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productionnotes</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> Match(note_text) Against(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">anvils</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 查询拓展</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> note_text</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productionnotes</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> Match(note_text) Against(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">anvils</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">WITH</span><span style="color:#A6ACCD;"> QUERY EXPANSION);</span></span>
<span class="line"></span></code></pre></div><h4 id="布尔文本搜索" tabindex="-1">布尔文本搜索 <a class="header-anchor" href="#布尔文本搜索" aria-hidden="true">#</a></h4><ul><li>要匹配的词</li><li>要排斥的词</li><li>排列提示</li><li>表达式分组等</li></ul><p>布尔文本搜索是非常缓慢的操作，即使没有定义 FULLTEXT 也可以使用。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 包含 anvils</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> note_text</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productionnotes</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> Match(note_text) Against(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">anvils</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">BOOLEAN</span><span style="color:#A6ACCD;"> MODE);</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 包含 (可选)anvils 和 (必选)heavy，增加前者的等级，降低后者的等级，排除rope开始的词</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> note_text</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productionnotes</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> Match(note_text) Against(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&gt;anvils +(&lt;heavy) -rope*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">BOOLEAN</span><span style="color:#A6ACCD;"> MODE);</span></span>
<span class="line"></span></code></pre></div><img src="/assets/mysql-全文本布尔操作符.fc1771e5.png" style="zoom:50%;"><h4 id="重要说明" tabindex="-1">重要说明 <a class="header-anchor" href="#重要说明" aria-hidden="true">#</a></h4><ul><li>索引全文本数据时，短词被忽略且从索引中排除。短词定义为那些具有3个或3个以下字符的词，数目可更改</li><li>MYSQL 自带一个内建的停用词列表，这些词在索引全文本数据时总是被忽略，如果需要，可以覆盖</li><li>许多词出现的频率很高，搜索他们没有用处，因此，MYSQL 规定了一条50%规则，如果一个词出现在50%以上的行中，则将它作为一个停用词忽略。50%规则不用于 IN BOOLEAN MODE</li><li>如果表中的行数少于3行，则全文本搜索不返回结果（因为每个词或者不出现，或者至少出现在50%的行中）</li><li>忽略词中的单引号</li><li>不具有词分隔符的语言不能恰当地反回全文本搜索结果，比如汉语</li><li>仅MyISAM引擎支持全文本搜索</li></ul><h3 id="插入数据" tabindex="-1">插入数据 <a class="header-anchor" href="#插入数据" aria-hidden="true">#</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">INSERT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> customers(</span></span>
<span class="line"><span style="color:#A6ACCD;">                      cust_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">                      cust_city)</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">shanghai</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>insert select</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">INSERT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> customers(cust_id,</span></span>
<span class="line"><span style="color:#A6ACCD;">                      cust_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">                      cust_city)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_id,</span></span>
<span class="line"><span style="color:#A6ACCD;">	cust_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">	cust_city</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> custnew;</span></span>
<span class="line"></span></code></pre></div><p>​ 为简单起见，这个例子在INSERT和SELECT语句中使用了相同的列名。但是，不一定要求列名匹配。事实上，MySQL甚至不关心SELECT返回的列名。它使用的是列的位置，因此SELECT中的第一列（不管其列名）将用来填充表列中指定的第一个列，第二列将用来填充表列中指定的第二个列，如此等等。这对于从使用不同列名的表中导入数据是非常有用的。</p><h3 id="更新数据" tabindex="-1">更新数据 <a class="header-anchor" href="#更新数据" aria-hidden="true">#</a></h3><h4 id="update" tabindex="-1">UPDATE <a class="header-anchor" href="#update" aria-hidden="true">#</a></h4><p>基本的UPDATE语句由3部分组成，分别是：</p><p>❑ 要更新的表；</p><p>❑ 列名和它们的新值；</p><p>❑ 确定要更新行的过滤条件。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">UPDATE</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> cust_email </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a@163.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		cust_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Fudds</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> cust_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1005</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>​ 即使是发生错误，也继续进行更新，可使用IGNORE关键字，如下所示：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">UPDATE</span><span style="color:#A6ACCD;"> IGNORE customers…</span></span>
<span class="line"></span></code></pre></div><h4 id="delete" tabindex="-1">DELETE <a class="header-anchor" href="#delete" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">DELETE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> cust_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1006</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>​ 如果想从表中删除所有行，不要使用DELETE。可使用TRUNCATE TABLE语句，它完成相同的工作，但速度更快（TRUNCATE实际是删除原来的表并重新创建一个表，而不是逐行删除表中的数据）。</p><p>​ 使用强制实施引用完整性的数据库(外键)，<strong>这样MySQL将不允许删除具有与其他表相关联的数据的行</strong>。</p><h3 id="创建和操纵表" tabindex="-1">创建和操纵表 <a class="header-anchor" href="#创建和操纵表" aria-hidden="true">#</a></h3><p>表的创建、更改、删除</p><h4 id="创建表" tabindex="-1">创建表 <a class="header-anchor" href="#创建表" aria-hidden="true">#</a></h4><p>至少包含名字和列的细节</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> customers </span><span style="color:#F78C6C;">IF</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">EXISTS</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	cust_id </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;"> 						</span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#A6ACCD;">	cust_name </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">) 		</span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    cust_address </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    cust_level </span><span style="color:#F78C6C;">level</span><span style="color:#A6ACCD;"> 				</span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">PRIMARY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">KEY</span><span style="color:#A6ACCD;"> (cust_id)</span></span>
<span class="line"><span style="color:#A6ACCD;">) ENGINE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">innerDB;</span></span>
<span class="line"></span></code></pre></div><p>​ IF NOT EXISTS 查看表名是否存在，并且仅在表名不存在时创建它。</p><p>​ 表中的每个行必须具有<strong>唯一</strong>的主键值。如果主键使用单个列，则它的值必须唯一。如果使用多个列，则这些列的组合值必须唯一。允许NULL值的列不能作为唯一标识。</p><blockquote><p>PRIMARY KEY (order_num, order_item)</p></blockquote><p>​ AUTO_INCREMENT，本列每当增加一行时自动增量，<strong>每个表只允许一个AUTO_INCREMENT列，而且它必须被索引</strong>。在 insert 时指定值可以覆盖 AUTO_INCREMENT ，后续的增量将基于该值。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 返回最后一个AUTO_INCREMENT值</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> last_insert_id</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h5 id="引擎" tabindex="-1">引擎 <a class="header-anchor" href="#引擎" aria-hidden="true">#</a></h5><p>❑ InnoDB是一个可靠的事务处理引擎，它不支持全文本搜索；</p><p>❑ MyISAM是一个性能极高的引擎，它支持全文本搜索，但不支持事务处理。</p><p>❑ MEMORY在功能等同于MyISAM，但由于数据存储在内存（不是磁盘）中，速度很快（特别适合于临时表）；</p><p>​ 混用引擎类型有一个大缺陷。外键（用于强制实施引用完整性）不能跨引擎，即使用一个引擎的表不能引用具有使用不同引擎的表的外键。</p><h4 id="更新表" tabindex="-1">更新表 <a class="header-anchor" href="#更新表" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> venders</span></span>
<span class="line"><span style="color:#F78C6C;">ADD</span><span style="color:#A6ACCD;"> vender_phone </span><span style="color:#F78C6C;">CHAR</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> venders</span></span>
<span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> COLUMN vender_phone;</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 增加外键</span></span>
<span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> orderitems</span></span>
<span class="line"><span style="color:#F78C6C;">ADD</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">CONSTRAINT</span><span style="color:#A6ACCD;"> fk_orderitems_orders </span></span>
<span class="line"><span style="color:#C792EA;">FOREIGN KEY</span><span style="color:#A6ACCD;"> (order_num) </span><span style="color:#C792EA;">REFERENCES</span><span style="color:#A6ACCD;"> orders (order_num);</span></span>
<span class="line"></span></code></pre></div><h4 id="删除表" tabindex="-1">删除表 <a class="header-anchor" href="#删除表" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> cumstomers;</span></span>
<span class="line"></span></code></pre></div><h4 id="重命名表" tabindex="-1">重命名表 <a class="header-anchor" href="#重命名表" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#A6ACCD;">RENAME </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> cumstomers2 </span><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> cumstomers;</span></span>
<span class="line"></span></code></pre></div><h3 id="视图" tabindex="-1">视图 <a class="header-anchor" href="#视图" aria-hidden="true">#</a></h3><p>​ 视图是虚拟的表，与包含数据的表不一样，视图只包含使用时动态检索的查询。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_name, cust_contact</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> c, orders </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> o, orderitems </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> oi</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> c.cust_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.cust_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> oi.order_num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.order_num</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> prod_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">APPLE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> productcustomers 是视图</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_name, cust_contact</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productcustomers</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> prod_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">APPLE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>下面是视图的一些常见应用。</p><p>❑ 重用SQL语句。</p><p>❑ 简化复杂的SQL操作。在编写查询后，可以方便地重用它而不必知道它的基本查询细节。</p><p>❑ 使用表的组成部分而不是整个表。</p><p>❑ 保护数据。可以给用户授予表的特定部分的访问权限而不是整个表的访问权限。</p><p>❑ 更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据。</p><blockquote><p>因为视图不包含数据，所以每次使用视图时，都必须处理查询执行时所需的任一个检索。如果你用多个联结和过滤创建了复杂的视图或者嵌套了视图，可能会发现性能下降得很厉害。因此，在部署使用了大量视图的应用前，应该进行测试。</p></blockquote><h4 id="创建" tabindex="-1">创建 <a class="header-anchor" href="#创建" aria-hidden="true">#</a></h4><p>❑ 视图用CREATE VIEW语句来创建。</p><p>❑ 使用SHOW CREATE VIEW viewname；来查看创建视图的语句。</p><p>❑ 用DROP删除视图，其语法为DROP VIEW viewname;。</p><p>❑ 更新视图时，可以先用DROP再用CREATE，也可以直接用CREATE OR REPLACEVIEW。如果要更新的视图不存在，则第2条更新语句会创建一个视图；如果要更新的视图存在，则第2条更新语句会替换原有视图。</p><h4 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-hidden="true">#</a></h4><h5 id="隐藏复杂的sql" tabindex="-1">隐藏复杂的SQL <a class="header-anchor" href="#隐藏复杂的sql" aria-hidden="true">#</a></h5><p>视图的最常见的应用之一是隐藏复杂的SQL，这通常都会涉及联结。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> VIEW productcustomers </span><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_name, cust_contact, prod_id</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers, orders, orderitems</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> customers.cust_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.cust_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> orderitems.order_num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.order_num;</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_name, cust_contact</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> productcustomers</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> prod_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">APPLE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>创建不受特定数据限制的视图是一种好办法。</p><h5 id="格式化检索出的数据" tabindex="-1">格式化检索出的数据 <a class="header-anchor" href="#格式化检索出的数据" aria-hidden="true">#</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> VIEW venderlocation </span><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Concat</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">RTrim</span><span style="color:#A6ACCD;">(vender_name), </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#82AAFF;">RTrim</span><span style="color:#A6ACCD;">(vender_contry), </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> vend_title</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> venders</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> vender_name;</span></span>
<span class="line"></span></code></pre></div><h5 id="过滤不想要的数据" tabindex="-1">过滤不想要的数据 <a class="header-anchor" href="#过滤不想要的数据" aria-hidden="true">#</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> VIEW cu stomeremaillist </span><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cust_id, cust_name, cust_email</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> cust_email </span><span style="color:#F78C6C;">IS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="更新" tabindex="-1">更新 <a class="header-anchor" href="#更新" aria-hidden="true">#</a></h4><p>​ 通常，视图是可更新的（即，可以对它们使用INSERT、UPDATE和DELETE）。更新一个视图将更新其基表。如果你对视图增加或删除行，实际上是对其基表增加或删除行。</p><p>​ 但是，并非所有视图都是可更新的。基本上可以说，如果MySQL不能正确地确定被更新的基数据，则不允许更新（包括插入和删除）。这实际上意味着，如果视图定义中有以下操作，则不能进行视图的更新：</p><p>❑ 分组（使用GROUP BY和HAVING）；</p><p>❑ 联结；</p><p>❑ 子查询；</p><p>❑ 并；</p><p>❑ 聚集函数（Min()、Count()、Sum()等）；</p><p>❑ DISTINCT；</p><p>❑ 导出（计算）列。</p><p><strong>视图主要用于数据检索</strong></p><h3 id="存储过程" tabindex="-1">存储过程 <a class="header-anchor" href="#存储过程" aria-hidden="true">#</a></h3><p>存储过程简单来说，就是为以后的使用而保存的一条或多条MySQL语句的集合，简单、安全、高性能。</p><p>❑ 通过把处理封装在容易使用的单元中，简化复杂的操作。</p><p>❑ 由于不要求反复建立一系列处理步骤，这保证了数据的完整性。如果所有开发人员和应用程序都使用同一（试验和测试）存储过程，则所使用的代码都是相同的。这一点的延伸就是防止错误。需要执行的步骤越多，出错的可能性就越大。防止错误保证了数据的一致性。</p><p>❑ 简化对变动的管理。如果表名、列名或业务逻辑（或别的内容）有变化，只需要更改存储过程的代码。使用它的人员甚至不需要知道这些变化。</p><p>❑ 提高性能。因为使用存储过程比使用单独的SQL语句要快。</p><p>❑ 存在一些只能用在单个请求中的MySQL元素和特性，存储过程可以使用它们来编写功能更强更灵活的代码</p><h4 id="执行" tabindex="-1">执行 <a class="header-anchor" href="#执行" aria-hidden="true">#</a></h4><p>CALL接受存储过程的名字以及需要传递给它的任意参数。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CALL</span><span style="color:#A6ACCD;"> productpricing(</span></span>
<span class="line"><span style="color:#A6ACCD;">	@pricelow,</span></span>
<span class="line"><span style="color:#A6ACCD;">	@pricehigh,</span></span>
<span class="line"><span style="color:#A6ACCD;">	@priceaverage</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h4 id="创建-1" tabindex="-1">创建 <a class="header-anchor" href="#创建-1" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PROCEDURE</span><span style="color:#A6ACCD;"> productpricing</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#F78C6C;">BEGIN</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Avg</span><span style="color:#A6ACCD;">(prod_price) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> priceaverage</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products;</span></span>
<span class="line"><span style="color:#F78C6C;">END</span></span>
<span class="line"></span></code></pre></div><p>​ 此存储过程名为productpricing，用<code>CREATE PROCEDURE productpricing()</code>语句定义。如果存储过程接受参数，它们将在()中列举出来。此存储过程没有参数，但后跟的()仍然需要。BEGIN和END语句用来限定存储过程体，过程体本身仅是一个简单的SELECT语句。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#A6ACCD;">DELIMITER </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PROCEDURE</span><span style="color:#A6ACCD;"> productpricing</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#F78C6C;">BEGIN</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Avg</span><span style="color:#A6ACCD;">(prod_price) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> priceaverage</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> products;</span></span>
<span class="line"><span style="color:#F78C6C;">END</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#A6ACCD;">DELIMITER ;</span></span>
<span class="line"></span></code></pre></div><p>​ 其中，<code>DELIMITER //</code>告诉命令行实用程序使用//作为新的语句结束分隔符，可以看到标志存储过程结束的END定义为END//而不是END;。这样，存储过程体内的；仍然保持不动，并且正确地传递给数据库引擎。最后，为恢复为原来的语句分隔符，可使用DELIMITER ;。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CALL</span><span style="color:#A6ACCD;"> productpricing</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="删除" tabindex="-1">删除 <a class="header-anchor" href="#删除" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#A6ACCD;"># 请注意没有使用后面的</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">，只给出存储过程名。</span></span>
<span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PROCEDURE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">IF</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#A6ACCD;"> productpricing;</span></span>
<span class="line"></span></code></pre></div><h4 id="使用参数" tabindex="-1">使用参数 <a class="header-anchor" href="#使用参数" aria-hidden="true">#</a></h4><p>​ MySQL支持IN（传递给存储过程）、OUT（从存储过程传出）和INOUT（对存储过程传入和传出）类型的参数。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PROCEDURE</span><span style="color:#A6ACCD;"> ordertotal(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> 	onumber </span><span style="color:#F78C6C;">INT</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">OUT</span><span style="color:#A6ACCD;"> total 	</span><span style="color:#F78C6C;">DECIMAL</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">BEGIN</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- 注释SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Sum</span><span style="color:#A6ACCD;">(item</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">quantity) </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> total</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orderitems</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> order_num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> onumber;</span></span>
<span class="line"><span style="color:#F78C6C;">END</span></span>
<span class="line"></span></code></pre></div><p>​ 存储过程的代码位于BEGIN和END语句内，如前所见，它们是一系列SELECT语句，用来检索值，然后保存到相应的变量（通过指定INTO关键字）。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CALL</span><span style="color:#A6ACCD;"> ordertotal(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">20005</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	@total</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> @total;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>所有MySQL变量都必须以@开始。</p></blockquote><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PROCEDURE</span><span style="color:#A6ACCD;"> ordertotal(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> 	onumber </span><span style="color:#F78C6C;">INT</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;">  taxable </span><span style="color:#C792EA;">BOOLEAN</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">OUT</span><span style="color:#A6ACCD;"> ototal 	</span><span style="color:#F78C6C;">DECIMAL</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">) COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">order total with tax</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F78C6C;">BEGIN</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- Declare</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">DECLARE</span><span style="color:#A6ACCD;"> total </span><span style="color:#F78C6C;">DECIMAL</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">DECLARE</span><span style="color:#A6ACCD;"> taxrate </span><span style="color:#F78C6C;">INT</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- Select</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Sum</span><span style="color:#A6ACCD;">(item</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">quantity) </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> total</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orderitems</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> order_num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> onumber;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- tax?</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">IF</span><span style="color:#A6ACCD;"> taxable </span><span style="color:#F78C6C;">THEN</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> total</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">(total</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">taxrate) </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> total;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ELSEIF .. </span><span style="color:#F78C6C;">THEN</span></span>
<span class="line"><span style="color:#A6ACCD;">  	..</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">ELSE</span></span>
<span class="line"><span style="color:#A6ACCD;">  	..</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">END</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">IF</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> total </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> ototal;</span></span>
<span class="line"><span style="color:#F78C6C;">END</span></span>
<span class="line"></span></code></pre></div><p>​ DECLARE要求指定变量名和数据类型，它也支持可选的默认值。</p><p>​ COMMENT 值将在 <code>SHOW PROCEDURE STATUS LIKE &#39;...&#39;</code>（获取何时、由谁创造等具体信息） 的结果中显示。</p><p>​ BOOLEAN值指定为非零值表示真，指定为0表示假。</p><h3 id="游标" tabindex="-1">游标 <a class="header-anchor" href="#游标" aria-hidden="true">#</a></h3><p>游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。MySQL游标只能用于存储过程（和函数）</p><p>使用游标涉及几个明确的步骤。</p><p>❑ 在能够使用游标前，必须声明（定义）它。这个过程实际上没有检索数据，它只是定义要使用的SELECT语句。</p><p>❑ 一旦声明后，必须打开游标以供使用。这个过程用前面定义的SELECT语句把数据实际检索出来。</p><p>❑ 对于填有数据的游标，根据需要取出（检索）各行。</p><p>❑ 在结束游标使用时，必须关闭游标。</p><p>在声明游标后，可根据需要频繁地执行取操作、打开和关闭游标。</p><p>在一个游标被打开后，可以使用<code>FETCH</code>语句分别访问它的每一行（自动从第一行开始）。<code>FETCH</code>指定检索什么数据（所需的列），检索出来的数据存储在什么地方。它还向前移动游标中的内部行指针，使下一条<code>FETCH</code>语句检索下一行（不重复读取同一行）。</p><p>存储过程处理完成后，游标就消失（因为它局限于存储过程）。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">PROCEDURE</span><span style="color:#A6ACCD;"> processorders</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#F78C6C;">BEGIN</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">DECLARE</span><span style="color:#A6ACCD;"> done </span><span style="color:#C792EA;">BOOLEAN</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">; </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">DECLARE</span><span style="color:#A6ACCD;"> o </span><span style="color:#F78C6C;">INT</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">DECLARE</span><span style="color:#A6ACCD;"> t </span><span style="color:#F78C6C;">DECIMAL</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- 定义游标</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">DECLARE</span><span style="color:#A6ACCD;"> ordernumbers </span><span style="color:#F78C6C;">CURSOR</span></span>
<span class="line"><span style="color:#A6ACCD;">	FOR</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> order_num </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orders;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- 这条语句定义了一个CONTINUE HANDLER，它是在条件出现时被执行的代码。这里，它指出当SQLSTATE &#39;02000’出现时，SET done=1。SQLSTATE &#39;02000’是一个未找到条件，当REPEAT由于没有更多的行供循环而不能继续时，出现这个条件。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">DECLARE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">CONTINUE</span><span style="color:#A6ACCD;"> HANDLER FOR SQLSTATE </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">02000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> done</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- store table</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">IF</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#A6ACCD;"> ordertotals (order_num </span><span style="color:#F78C6C;">INT</span><span style="color:#A6ACCD;">, total </span><span style="color:#F78C6C;">DECIMAL</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">OPEN</span><span style="color:#A6ACCD;"> ordernumbers;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">REPEAT</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">FETCH</span><span style="color:#A6ACCD;"> ordernumbers </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> o;</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;">-- get total into t</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">CALL</span><span style="color:#A6ACCD;"> ordertotals(o, </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, t);</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">INSERT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> ordertotals(order_num, total) </span><span style="color:#F78C6C;">VALUES</span><span style="color:#A6ACCD;">(o, t);</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;">-- other ...</span></span>
<span class="line"><span style="color:#A6ACCD;">	UNTIL done </span><span style="color:#F78C6C;">END</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">REPEAT</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">CLOSE</span><span style="color:#A6ACCD;"> ordernumbers;</span></span>
<span class="line"><span style="color:#F78C6C;">END</span></span>
<span class="line"></span></code></pre></div><p>用DECLARE语句定义的局部变量必须在定义任意游标或句柄之前定义，而句柄必须在游标之后定义。</p><h3 id="触发器" tabindex="-1">触发器 <a class="header-anchor" href="#触发器" aria-hidden="true">#</a></h3><p>触发器是MYSQL响应以下任意语句而自动执行的一条MYSQL语句（或位于BEGIN和END语句之间的一组语句）：</p><p>❑ DELETE；❑ INSERT；❑ UPDATE。</p><h4 id="创建触发器" tabindex="-1">创建触发器 <a class="header-anchor" href="#创建触发器" aria-hidden="true">#</a></h4><p>在创建触发器（只有表才支持触发器，视图不支持）时，需要给出4条信息：</p><p>❑ 唯一的触发器名；</p><p>❑ 触发器关联的表；</p><p>❑ 触发器应该响应的活动（DELETE、INSERT或UPDATE）；</p><p>❑ 触发器何时执行（处理之前或之后）。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> TRIGGER newproduct </span><span style="color:#F78C6C;">AFTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INSERT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> products</span></span>
<span class="line"><span style="color:#A6ACCD;">FOR EACH </span><span style="color:#F78C6C;">ROW</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Product added</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>触发器按每个表每个事件每次的定义，每个表每个事件每次只允许一个触发器，因此，每个表最多支持6个触发器（每条INSERT、UPDATE和DELETE的之前和之后），一个触发器对应一个事件。</p><blockquote><p>如果 BEFORE 触发器失败，则MySQL 将不执行请求的操作以及AFTER触发器。</p></blockquote><h4 id="删除触发器" tabindex="-1">删除触发器 <a class="header-anchor" href="#删除触发器" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> TRIGGER newproduct;</span></span>
<span class="line"></span></code></pre></div><p>触发器不能更新或覆盖，要修改一个触发器，必须先删除它，然后重新创建。</p><h4 id="insert-触发器" tabindex="-1">INSERT 触发器 <a class="header-anchor" href="#insert-触发器" aria-hidden="true">#</a></h4><p>❑ 在INSERT触发器代码内，可引用一个名为NEW的虚拟表，访问被插入的行；</p><p>❑ 在BEFORE INSERT触发器中，NEW中的值也可以被更新（允许更改被插入的值）；</p><p>❑ 对于AUTO_INCREMENT列，NEW在INSERT执行之前包含0，在INSERT执行之后包含新的自动生成值。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> TRIGGER neworder </span><span style="color:#F78C6C;">AFTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INSERT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> orders</span></span>
<span class="line"><span style="color:#A6ACCD;">FOR EACH </span><span style="color:#F78C6C;">ROW</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> NEW.order num;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>通常，将 BEFORE 用于数据验证和净化，保证插入表中的数据是正确的</p></blockquote><h4 id="delete-触发器" tabindex="-1">DELETE 触发器 <a class="header-anchor" href="#delete-触发器" aria-hidden="true">#</a></h4><p>❑ 在DELETE触发器代码内，你可以引用一个名为OLD的虚拟表，访问被删除的行；</p><p>❑ OLD中的值全都是只读的，不能更新。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> TRIGGER deleteorder </span><span style="color:#F78C6C;">BEFORE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DELETE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> orders</span></span>
<span class="line"><span style="color:#A6ACCD;">FOR EACH </span><span style="color:#F78C6C;">ROW</span></span>
<span class="line"><span style="color:#F78C6C;">BEGIN</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">-- 标记触发体</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">INSERT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> archive_orders(order_num, order_date, cust_id)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">VALUES</span><span style="color:#A6ACCD;">(OLD.order_num, OLD.order_date, OLD.cust_id);</span></span>
<span class="line"><span style="color:#F78C6C;">END</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="update-触发器" tabindex="-1">UPDATE 触发器 <a class="header-anchor" href="#update-触发器" aria-hidden="true">#</a></h4><p>❑ 在UPDATE触发器代码中，你可以引用一个名为OLD的虚拟表访问以前（UPDATE语句前）的值，引用一个名为NEW的虚拟表访问新更新的值；</p><p>❑ 在BEFORE UPDATE触发器中，NEW中的值可能也被更新（允许更改将要用于UPDATE语句中的值）；</p><p>❑ OLD中的值全都是只读的，不能更新。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> TRIGGER updatevender </span><span style="color:#F78C6C;">BEFORE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">UPDATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> venders</span></span>
<span class="line"><span style="color:#A6ACCD;">FOR EACH </span><span style="color:#F78C6C;">ROW</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> NEW.vend_stat </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Upper</span><span style="color:#A6ACCD;">(NEW.vend_stat);</span></span>
<span class="line"></span></code></pre></div><h4 id="tips" tabindex="-1">TIPS <a class="header-anchor" href="#tips" aria-hidden="true">#</a></h4><p>❑ 与其他DBMS相比，MySQL 5中支持的触发器相当初级。未来的MySQL版本中有一些改进和增强触发器支持的计划。</p><p>❑ 创建触发器可能需要特殊的安全访问权限，但是，触发器的执行是自动的。如果INSERT、UPDATE或DELETE语句能够执行，则相关的触发器也能执行。</p><p>❑ 应该用触发器来保证数据的一致性（大小写、格式等）。在触发器中执行这种类型的处理的优点是它总是进行这种处理，而且是透明地进行，与客户机应用无关。</p><p>❑ 触发器的一种非常有意义的使用是创建审计跟踪。使用触发器，把更改（如果需要，甚至还有之前和之后的状态）记录到另一个表非常容易。</p><p>❑ 遗憾的是，MySQL触发器中不支持CALL语句。这表示不能从触发器内调用存储过程。所需的存储过程代码需要复制到触发器内。</p><h3 id="管理事务处理" tabindex="-1">管理事务处理 <a class="header-anchor" href="#管理事务处理" aria-hidden="true">#</a></h3><p>​ 事务处理（transaction processing）可以用来维护数据库的完整性，保证成批的MySQL操作要么完全执行，要么完全不执行。</p><p>❑ 事务（transaction）指一组SQL语句；</p><p>❑ 回退（rollback）指撤销指定SQL语句的过程；</p><p>❑ 提交（commit）指将未存储的SQL语句结果写入数据库表；</p><p>❑ 保留点（savepoint）指事务处理中设置的临时占位符（place-holder），你可以对它发布回退（与回退整个事务处理不同）。</p><h4 id="rollback" tabindex="-1">ROLLBACK <a class="header-anchor" href="#rollback" aria-hidden="true">#</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ordertotals;</span></span>
<span class="line"><span style="color:#F78C6C;">START</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TRANSACTION</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">DELETE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ordertotals;</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ordertotals;</span></span>
<span class="line"><span style="color:#676E95;">-- ROLLBACK 只能在一个事务处理内使用</span></span>
<span class="line"><span style="color:#F78C6C;">ROLLBACK</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ordertotals;</span></span>
<span class="line"></span></code></pre></div><h4 id="commit" tabindex="-1">COMMIT <a class="header-anchor" href="#commit" aria-hidden="true">#</a></h4><blockquote><p>隐含提交，提交操作是自动进行的，一般的MySQL语句都是隐含提交的</p></blockquote><p>在事务处理块中，必须使用 COMMIT 明确地提交。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">START</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TRANSACTION</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">DELETE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ordertotals </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> order_num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20010</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">COMMIT</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>当 COMMIT 或 ROLLBACK 语句执行后，事务将自动关闭。</p><h4 id="保留点" tabindex="-1">保留点 <a class="header-anchor" href="#保留点" aria-hidden="true">#</a></h4><p>​ 保留点是占位符，支持回退部分事务处理。每个保留点都取标识它的唯一名字，以便在回退时，MySQL知道要回退到何处。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#A6ACCD;">SAVEPOINT delete1;</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#F78C6C;">ROLLBACK</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> delete1;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>保留点在事务处理完成（执行一条ROLLBACK或COMMIT）后自动释放，也可以用RELEASE SAVEPOINT明确地释放保留点。</p></blockquote><h4 id="更改默认的提交行为" tabindex="-1">更改默认的提交行为 <a class="header-anchor" href="#更改默认的提交行为" aria-hidden="true">#</a></h4><p>为指示MySQL不自动提交更改，需要使用以下语句：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 0 为假</span></span>
<span class="line"><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> autocommit</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>autocommit标志是针对每个连接而不是服务器的。</p></blockquote><h3 id="全球化和本地化" tabindex="-1">全球化和本地化 <a class="header-anchor" href="#全球化和本地化" aria-hidden="true">#</a></h3></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-bd22cb21 data-v-66ddf6b8><div class="edit-info" data-v-66ddf6b8><!----><div class="last-updated" data-v-66ddf6b8><p class="VPLastUpdated" data-v-66ddf6b8 data-v-6fd011f6>Last updated: <time datatime="2023-01-08T13:05:15.000Z" data-v-6fd011f6></time></p></div></div><div class="prev-next" data-v-66ddf6b8><div class="pager" data-v-66ddf6b8><a class="pager-link prev" href="/server/java/compare.html" data-v-66ddf6b8><span class="desc" data-v-66ddf6b8>Previous page</span><span class="title" data-v-66ddf6b8>compare</span></a></div><div class="has-prev pager" data-v-66ddf6b8><a class="pager-link next" href="/server/database/mysql/%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B.html" data-v-66ddf6b8><span class="desc" data-v-66ddf6b8>Next page</span><span class="title" data-v-66ddf6b8>基础类型</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"front-end_canvas_canvas.md\":\"7b453637\",\"front-end_code_snap_css_index.md\":\"0b375223\",\"front-end_code_snap_js_freeze.md\":\"dc76a186\",\"front-end_code_snap_js_index.md\":\"d1ae2e86\",\"front-end_css_forefront.md\":\"48e2c821\",\"front-end_css_index.md\":\"1a3da1e9\",\"front-end_css_magic.md\":\"fd12b9d3\",\"front-end_css_sass.md\":\"7e7d704e\",\"front-end_index.md\":\"d248eb2e\",\"front-end_js_bom.md\":\"62ee4c37\",\"front-end_js_index.md\":\"2340d22d\",\"front-end_js_promise.md\":\"a6e7338a\",\"front-end_js_rxjs.md\":\"e3d3d4f5\",\"front-end_js_vue_reactivity.md\":\"74ca53f3\",\"front-end_js_vue_组件化实践.md\":\"b34c13d4\",\"front-end_js_函数式编程.md\":\"d24215aa\",\"front-end_js_对象.md\":\"75e6592a\",\"index.md\":\"2c4f13d1\",\"server_database_elasticsearch_mapping.md\":\"7d356536\",\"server_database_elasticsearch_index.md\":\"eedd7ce6\",\"server_database_elasticsearch_search.md\":\"398a262c\",\"server_database_elasticsearch_search_api.md\":\"f85ce946\",\"server_database_elasticsearch_倒排索引.md\":\"288848b5\",\"server_database_elasticsearch_基础.md\":\"24e3902d\",\"server_database_elasticsearch_文档crud.md\":\"9065c867\",\"server_database_mysql_index.md\":\"ebdb6086\",\"server_database_mysql_基础类型.md\":\"a2fc4149\",\"server_database_mysql_必知必会.md\":\"23977e56\",\"server_database_mysql_执行优化.md\":\"ba4b1699\",\"server_database_mysql_数据目录.md\":\"58ebb908\",\"server_database_mysql_索引页数据结构.md\":\"8e66c7f4\",\"server_docker_compose.md\":\"0bb71815\",\"server_docker_container.md\":\"8d3163bd\",\"server_docker_image.md\":\"a34bc2e9\",\"server_docker_index.md\":\"29e09888\",\"server_java_0-jvm params.md\":\"d22c17a2\",\"server_java_1-memory area.md\":\"641c946d\",\"server_java_2-garbage collect.md\":\"7f923806\",\"server_java_compare.md\":\"75c297fa\",\"server_java_concurrent_基础.md\":\"8f30a281\",\"server_java_index.md\":\"c074bf82\",\"server_java_reentrantlock.md\":\"35d5a397\",\"server_java_threadlocal.md\":\"0376682b\",\"server_java_线程池.md\":\"e7dc47b9\",\"server_java_锁.md\":\"ebb3f31b\",\"server_java_阻塞队列.md\":\"539e8504\",\"server_note_code_complete.md\":\"1a64d6c1\",\"server_note_类图.md\":\"44a109c6\",\"test_index.md\":\"c4d27d12\",\"util_command_git.md\":\"973f7162\",\"util_command_index.md\":\"67fb0d19\",\"util_command_linux.md\":\"c79c0ec8\",\"util_command_mysql.md\":\"840142a4\",\"util_command_nginx.md\":\"d830fc00\",\"util_command_node.md\":\"1e70c3c1\",\"设计模式_design_rule.md\":\"9ab2cca7\",\"设计模式_index.md\":\"9e002565\",\"设计模式_readable.md\":\"042d93a5\"}")</script>
    <script type="module" async src="/assets/app.468f540d.js"></script>
    
  </body>
</html>