#### 1. 集群

- 分布式架构
- 不同的集群通过不同的名字区分，默认名字 “elasticsearch”
- 通过配置文件修改，或者在命令行中 -E cluster.name=name 进行设定
- 一个集群可以有一个或多个节点



#### 2. 节点

- 节点是一个Elasticsearch的实例
  - 本质上是一个 java 进程
  - 一台机器上可以运行多个 es 进程，但生产环境一般建议一台机器上只运行一个 es 实例
- 每个节点都有自己的名字，通过配置文件，或者启动时通过 -E node.name=node1 指定
- 每一个节点在启动后，会分配一个 UID，保存在 data 目录下

- Master eligible nodes 和 Master node
  - 节点启动后，默认就是一个 Master eligible 节点，可以设置 node.master: false 禁止
  - Master eligible节点可以参加选主流程，成为 Master 节点
  - 第一个节点启动时，它会将自己选举成 Master 节点
  - 每个节点上都保存了集群的状态，只有 Master 节点才能修改集群的状态信息
    - 集群状态维护了一个集群中必要的信息
      - 所有节点的信息
      - 所有的索引和其相关的 Mapping 和 Setting 信息
      - 分片的路由信息
- Data Node 和 Coordinating Node
  - Data Node：可以保存数据的节点
  - Coordinating Node：负责接收 Client 请求，将请求分发到合适的节点，最终把结果汇集到一起，每个节点都起到了 Coordinating Node 的职责

#### 3. 分片

- 主分片（Primary Shard）
  - 用于解决数据水平拓展的问题，通过主分片，可以将数据分布到集群内所有的节点上
  - 一个分片就是一个运行的 Lucene 的实例
  - 主分片数在索引创建时定义，后续不允许修改，除非 Reindex
- 副分片（Replica Shard）
  - 用以解决数据高可用问题，分片是主分片的拷贝
  - 副本分片数可以动态调整
  - 增加副本数，还可以在一定程度上提高服务的可用性（读取的吞吐）
- 主分片设置（默认1）
  - 过小
    - 导致后续无法增加节点实现水平拓展
    - 单分片的数据量太大，导致数据重新分配耗时
  - 过大
    - 影响搜索结果的相关性打分，影响统计结果的准确性
    - 单个节点上过多的分片，会导致资源浪费，影响性能
- GET _cluster/health
  - Green: 主分片和副本都正常分配
  - Yellow：主分片全部正常分配，有副本分片未能正常分配
  - Red：有主分片未能分配，eg：当服务器磁盘容量超过85%时，去创建了一个新的索引

